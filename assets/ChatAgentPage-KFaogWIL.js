import{u as M,a as C,j as e}from"./index-BJ_bIQZb.js";import{r as a}from"./router-BSEL9h4o.js";import{c as I}from"./supabase-BtyFyo3r.js";import"./vendor-RGnvvjkK.js";const S="https://xibewgvrooyvbragtwxm.supabase.co",L="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhpYmV3Z3Zyb295dmJyYWd0d3htIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMTQ4MjMsImV4cCI6MjA3MjU5MDgyM30.sbHGfxvJMdMibCLUvxlQprpDp6Fsm6ZxkGuna2tePI4";let h;try{h=I(S,L)}catch{console.warn("Supabase client initialization failed"),h=void 0}const D=()=>{const{user:v}=M(),{showToast:m}=C(),[n,u]=a.useState([]),[l,i]=a.useState(""),[x,p]=a.useState(!1),[b,j]=a.useState(!1),g=a.useRef(null),f=()=>{g.current?.scrollIntoView({behavior:"smooth"})};a.useEffect(()=>{f()},[n]);const w=()=>{j(!0)},y=()=>{j(!1)},c=async()=>{if(!l.trim()||x)return;const s={id:Date.now().toString(),role:"user",content:l,timestamp:new Date};u(t=>[...t,s]),i(""),p(!0);try{let t;try{if(h?.auth){const{data:{session:r}}=await h.auth.getSession();t=r?.access_token}}catch(r){console.warn("No Supabase session:",r)}const d=await fetch("/api/functions/v1/deepseek-agent",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0"},body:JSON.stringify({question:l})});if(!d.ok)throw new Error(`Server error: ${d.status}`);const o=await d.json(),k={id:(Date.now()+1).toString(),role:"assistant",content:o.success?o.result.answer:"Извините, произошла ошибка при обработке запроса.",timestamp:new Date,sources:o.success?o.result.sources.map(r=>({id:r.id,title:r.title,url:r.url})):void 0};u(r=>[...r,k]),o.success||m("error","Ошибка",o.error||"Не удалось получить ответ")}catch(t){console.error("Chat error:",t);const d={id:(Date.now()+1).toString(),role:"assistant",content:"Произошла ошибка при подключении к ИИ-агенту. Попробуйте позже.",timestamp:new Date};u(o=>[...o,d]),m("error","Ошибка соединения","Не удалось подключиться к ИИ-агенту")}finally{p(!1)}},N=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),c())};return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"mx-auto bg-blue-100 p-4 rounded-full w-16 h-16 flex items-center justify-center mb-4",children:e.jsx("svg",{className:"icon-xl text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-4l-4 4-4-4z"})})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"ИИ-Консультант по документам СРО"}),e.jsx("p",{className:"text-gray-600",children:"Задайте вопрос по документам саморегулируемой организации"})]}),n.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-8 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Как я могу помочь?"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"Я могу ответить на вопросы по уставу СРО, требованиям к членству, квалификационным стандартам, положению о страховании, компенсационных фондах и многим другим документам."}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[e.jsx("button",{onClick:()=>{i("Какие требования к членству в СРО?"),c()},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 text-sm font-medium border border-blue-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Требования к членству"]})}),e.jsx("button",{onClick:()=>{i("Что такое компенсационный фонд?"),c()},className:"px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 text-sm font-medium border border-green-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),"Компенсационный фонд"]})}),e.jsx("button",{onClick:()=>{i("Какие квалификационные требования к руководителю?"),c()},className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 text-sm font-medium border border-purple-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Квалификация руководителя"]})})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[n.length>0&&e.jsxs("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:w,className:"text-sm text-gray-600 hover:text-blue-600 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"История чата (",n.length," сообщений)"]}),b&&e.jsx("button",{onClick:y,className:"text-sm text-blue-600 hover:text-blue-800",children:"Скрыть историю"})]}),e.jsx("span",{className:"text-sm text-gray-500",children:"Сессия активна"})]}),b&&e.jsxs("div",{className:"mt-2 flex space-x-2 text-sm",children:[e.jsx("button",{className:"text-blue-600 hover:text-blue-800 underline",onClick:()=>document.querySelector(".h-96")?.scrollTo({top:0,behavior:"smooth"}),children:"↑ К началу"}),e.jsx("button",{className:"text-blue-600 hover:text-blue-800 underline",onClick:()=>f(),children:"↓ К концу"})]})]}),e.jsxs("div",{className:"h-96 overflow-y-auto p-4 space-y-4",children:[n.map(s=>e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${s.role==="user"?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"}`,children:[e.jsx("p",{className:"whitespace-pre-wrap",children:s.content}),s.sources&&s.sources.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Источники:"}),e.jsx("div",{className:"space-y-1",children:s.sources.slice(0,3).map(t=>e.jsx("div",{children:e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-800 underline block truncate",title:t.title,children:t.title})},t.id))})]}),e.jsx("p",{className:`text-xs ${s.role==="user"?"text-blue-100":"text-gray-500"} mt-2`,children:s.timestamp.toLocaleTimeString()})]})},s.id)),e.jsx("div",{ref:g})]}),e.jsxs("div",{className:"border-t border-gray-200 p-4",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("input",{type:"text",value:l,onChange:s=>i(s.target.value),onKeyPress:N,placeholder:"Задайте вопрос по документам СРО...",disabled:x,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"}),e.jsx("button",{onClick:c,disabled:!l.trim()||x,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:x?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"icon-standard mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),"Отправить"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"ИИ отвечает на основе официальных документов СРО НОСО"})]})]})]})})};export{D as default};

import{j as e,u as k}from"./index-42zkujaZ.js";import{r as m,b as y,u as N,L}from"./router-BSEL9h4o.js";import"./supabase-BtyFyo3r.js";import"./vendor-RGnvvjkK.js";const S=({mode:i,backendStatus:x,websiteStatus:o})=>{const r=()=>i==="local"?"Локальный":"Продакшен",d=()=>i==="local"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800",n=l=>{switch(l){case"online":return e.jsx("svg",{className:"w-4 h-4 text-green-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})});case"offline":return e.jsx("svg",{className:"w-4 h-4 text-red-500 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})});case"checking":return e.jsx("div",{className:"w-4 h-4 bg-yellow-500 rounded-full mr-2 animate-pulse"});default:return e.jsx("div",{className:"w-4 h-4 bg-gray-400 rounded-full mr-2"})}},u=l=>{switch(l){case"online":return"Онлайн";case"offline":return"Оффлайн";case"checking":return"Проверка...";default:return"Неизвестно"}};return e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-600",children:"Статус системы:"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:`flex items-center px-3 py-2 rounded-lg text-sm ${d()}`,children:[e.jsxs("svg",{className:"w-4 h-4 text-current mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Режим: ",r()]}),e.jsxs("div",{className:"flex items-center px-3 py-2 bg-gray-100 rounded-lg text-sm text-gray-700",children:[n(x),"Backend: ",u(x)]}),e.jsxs("div",{className:"flex items-center px-3 py-2 bg-gray-100 rounded-lg text-sm text-gray-700",children:[n(o),"Сайт СРО: ",u(o)]})]})]})},C=()=>{const[i,x]=m.useState("prod"),[o,r]=m.useState("checking"),[d,n]=m.useState("checking"),u=async()=>{r("checking");try{if(typeof window<"u"&&window.location.hostname.includes("localhost")){const c=await fetch("http://127.0.0.1:54321/functions/v1/reestr-parser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inn:"test123"}),signal:AbortSignal.timeout(5e3)});r(c.status>=400?"offline":"online")}else{const c=await fetch("https://xibewgvrooyvbragtwxm.supabase.co/functions/v1/reestr-parser",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0"},body:JSON.stringify({inn:"test123"}),signal:AbortSignal.timeout(15e3)});r(c.status>=400?"offline":"online")}}catch(t){console.error("Backend status check failed:",t),r("offline")}},l=async()=>{n("checking");try{const t=new AbortController,a=setTimeout(()=>t.abort(),5e3);let c;try{if(c=await fetch("https://sronoso.ru",{method:"GET",mode:"no-cors",cache:"no-cache",signal:t.signal}),clearTimeout(a),c){n("online");return}}catch{clearTimeout(a)}const h=new Image,g=setTimeout(()=>{n("offline")},5e3);h.onload=()=>{clearTimeout(g),n("online")},h.onerror=()=>{clearTimeout(g),n("offline")},h.src=`https://sronoso.ru/favicon.ico?t=${Date.now()}`}catch(t){console.error("Website status check failed:",t),n("offline")}};return m.useEffect(()=>{const t=typeof window<"u"&&window.location.hostname.includes("localhost");x(t?"local":"prod"),u(),l();const a=setInterval(()=>{u(),l()},3e4);return()=>clearInterval(a)},[]),{mode:i,backendStatus:o,websiteStatus:d}},W=()=>{m.useEffect(()=>{window.scrollTo(0,0)},[]);const[i,x]=m.useState(""),[o,r]=m.useState(!1),d=y(),n=N(),{signIn:u,checkInnExists:l,verificationStatus:t,loginError:a,clearLoginError:c,setLoginError:h}=k(),{mode:g,backendStatus:f,websiteStatus:j}=C(),p=n.state?.from?.pathname||"/profile",w=async s=>{s.preventDefault(),i.trim()&&await b()},b=async()=>{r(!0),c();try{(await u(i.trim())).success&&d(p,{replace:!0})}catch(s){console.error("Login error:",s)}finally{r(!1)}},v=async()=>{r(!0),c();try{const s=await l(i.trim());s.exists&&s.data?(console.log("Local login successful:",s.data),d(p,{replace:!0})):h({message:"Данные не найдены в локальном реестре",showRetryButtons:!1})}catch(s){console.error("Local login error:",s),h({message:"Ошибка при входе через локальный реестр",showRetryButtons:!0})}finally{r(!1)}};return e.jsx("div",{className:"w-full max-w-md mx-auto px-4 py-8 flex justify-center",children:e.jsxs("div",{className:"w-full bg-white p-8 rounded-xl shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"mx-auto bg-blue-100 p-3 rounded-full w-16 h-16 flex items-center justify-center mb-4",children:e.jsxs("svg",{className:"icon-xl text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"1.5",children:[e.jsx("circle",{cx:"12",cy:"12",r:"11"}),e.jsx("circle",{cx:"12",cy:"9",r:"3"}),e.jsx("path",{d:"M5 20c0-3 3-5 7-5s7 2 7 5"})]})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Вход для членов СРО"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Введите ваш ИНН для доступа к личному кабинету"})]}),e.jsx(S,{mode:g,backendStatus:f,websiteStatus:j}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"inn",className:"flex items-center text-gray-700 text-sm font-bold mb-2",children:[e.jsx("svg",{className:"icon-standard mr-1 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"ИНН"]}),e.jsx("input",{type:"text",id:"inn",value:i,onChange:s=>x(s.target.value),disabled:o,className:"shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Введите 10 или 12 цифр",required:!0,pattern:"\\d{10}|\\d{12}",title:"ИНН должен состоять из 10 (для юрлиц) или 12 (для физлиц) цифр"})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("button",{type:"submit",disabled:o,className:"btn-primary w-full flex justify-center items-center disabled:opacity-50 disabled:cursor-not-allowed",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Вход..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"icon-standard mr-2 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})}),"Войти"]})})})]}),t.isChecking&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600 mr-3"}),e.jsx("span",{className:"text-blue-800 text-sm font-medium",children:t.currentStep})]}),t.currentStep&&!t.isChecking&&e.jsx("div",{className:`mt-4 p-3 border rounded-lg flex items-center ${t.dataSource?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:t.dataSource?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-green-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-green-800 text-sm font-medium",children:"Данные найдены успешно"})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),e.jsx("span",{className:"text-red-800 text-sm font-medium",children:"Данные не найдены"})]})}),a&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-red-800 text-sm font-medium",children:a.message})]}),a.showRetryButtons&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:b,disabled:o,className:"flex-1 bg-blue-600 text-white py-2 px-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 text-sm font-medium",children:"Попробовать ещё раз"}),e.jsx("button",{onClick:v,disabled:o,className:"flex-1 bg-green-600 text-white py-2 px-3 rounded-lg hover:bg-green-700 disabled:opacity-50 text-sm font-medium",children:"Войти через локальный реестр"})]}),e.jsx("button",{onClick:()=>d("/"),className:"w-full bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 text-sm font-medium",children:"Перейти на Главную страницу"})]})]}),e.jsxs("div",{className:"mt-6 text-center text-sm text-gray-600",children:[e.jsx("p",{children:"Еще не являетесь членом СРО?"}),e.jsx(L,{to:"/chat",className:"text-blue-600 hover:underline font-medium",children:"Получите бесплатную консультацию"})]})]})})};export{W as default};
